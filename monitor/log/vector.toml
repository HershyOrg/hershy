[sources.dummy]
type = "demo_logs"
format = "json"
interval = 1.0

[transforms.add_ts]
type = "remap"
inputs = ["dummy"]
source = '''
.timestamp = now()
.host = "vector-node"
'''

[sinks.loki]
type = "loki"
inputs = ["add_ts"]
endpoint = "http://loki:3100"
encoding.codec = "json"

# 1. 헬스체크 설정: 시작 시 Loki가 안 떠있어도 Vector가 죽지 않게 함
healthcheck.enabled = false 

# 2. 재시도 및 버퍼 설정 
[sinks.loki.buffer]
type = "memory"       # 메모리에 임시 보관 (재시작 시 삭제됨, 영구 보관은 "disk" 사용)
max_events = 10000    # 최대 1만 개의 이벤트를 쌓아둠
when_full = "block"   # 버퍼가 꽉 차면 소스 읽기를 중단하여 데이터 유실 방지

[sinks.loki.request]
retry_attempts = 100               # 재시도 횟수 
retry_initial_backoff_secs = 1     # 첫 재시도 대기 시간
retry_max_backoff_secs = 30        # 재시도 간격 최대치 (Loki가 15초 뒤에 뜸)

[sinks.loki.labels]
job = "vector-test"
env = "development"